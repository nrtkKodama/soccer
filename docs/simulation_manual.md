# サッカーシミュレーション・ロジック仕様書

本ドキュメントでは、このプログラムがどのようにサッカーの試合をシミュレートしているか、その内部ロジックとパラメータについて解説します。

## 1. 概要 (Overview)

このシミュレーションエンジンは、現代サッカーの戦術要素（フォーメーション、プレースタイル、チーム戦術）を簡易モデル化し、確率論的アプローチを用いて試合結果を導出します。
物理演算エンジンではなく、**戦術パラメータと選手能力に基づく行動成功率**によって試合が進行します。

- **試合時間**: 1試合あたり200ステップ（約90分相当として処理）
- **参加人数**: 11人 vs 11人
- **判定基準**: 攻撃側と守備側のステータス対決（数値比較 + 乱数）

---

## 2. 構成要素 (Key Components)

### 2.1 フォーメーション (Formations)
攻撃時と守備時で異なるフォーメーション（可変システム）を採用しています。
- **攻撃時**: 攻撃的な配置（ウイングバックが高い位置を取るなど）
- **守備時**: ディフェンスラインの高さに応じたブロック形成

データ定義: `js/formations.js`
- `positions`: 各選手の基本座標 (x, y)
- `attackBias`: 攻撃時の前掛かり補正
- `defenseBias`: 守備時のリトリート補正

### 2.2 戦術パラメータ (Tactics)
eFootball等のゲームを参考に、以下のパラメータが設定されています。

**攻撃戦術 (Attack Strategies)**
| パラメータ | 説明 | 影響 |
|---|---|---|
| **Build Up** | Short / Long | ショートパス成功率 / 前線への放り込み頻度 |
| **Attack Area** | Center / Wide | 中央突破優先 / サイド攻撃優先 |
| **Counter Speed** | 0.0 ~ 1.0 | ボール奪取後の攻撃切替速度（高いほどドリブル選択率UP） |
| **Pass Accuracy** | 0.0 ~ 1.0 | 全体的なパス成功率へのボーナス |
| **Cross Freq** | 0.0 ~ 1.0 | サイドエリアでのクロス選択率 |

**守備戦術 (Defense Strategies)**
| パラメータ | 説明 | 影響 |
|---|---|---|
| **Press Intensity** | 0.0 ~ 1.0 | ボールホルダーへの寄せの速さ（タックル成功率UP） |
| **Line Height** | 0.0 ~ 1.0 | ディフェンスラインの高さ（高いとスルーパスを通されやすいが、押し込みやすい） |
| **Compactness** | 0.0 ~ 1.0 | 守備ブロックの密度（高いとシュートブロック率UP / 中央突破阻止率UP） |
| **Cover Range** | 0.0 ~ 1.0 | インターセプト範囲の広さ |

### 2.3 選手属性 (Player Types)
ポジションごとに「選手タイプ」を設定し、能力値に補正をかけます。
- **FW**: Speed (裏抜け), Power (決定力), Technique (リンクマン)
- **MF**: Playmaker (パス), Box2Box (運動量), Attacker (攻撃参加)
- **DF**: Stopper (対人), Cover (カバーリング), BuildUp (パス出し)

能力値 (Stats):
- **Speed**: 移動速度、ドリブル突破力
- **Power**: シュート力、フィジカル競り合い（ヘディング/ブロック）
- **Technique**: パス精度、ボールキープ力
- **Defense**: ボール奪取力、インターセプト成功率

---

## 3. シミュレーションの流れ (Simulation Process)

毎ステップ（0〜199）、以下のプロセスで試合が進行します。

### Step 1: 選手の移動 (Movement)
選手はフォーメーションの「基本位置」に向かって移動します。
- **攻撃側**: 戦術エリア（サイド/中央）やボール位置に応じて微調整。
- **守備側**: `Line Height`（ラインの高さ）やボール位置に合わせてラインコントロールを行います。
- ※ `Speed`ステータスが高い選手ほど、素早くポジション修正が可能です。

### Step 2: 行動決定 (Decision Making)
ボールホルダー（ボールを持っている選手）は、状況に応じて行動を選択します。

1. **シュート (Shoot)**: ゴールに近く、かつ射線が通っている場合。
2. **クロス (Cross)**: サイド深く（Deep Zone）に侵入した場合。
3. **スルーパス (Through Ball)**: 前線の味方が裏へ抜け出せそうな場合（相手ラインが高い時など）。
4. **ドリブル (Dribble)**: 近くに敵がいない、または「カウンター」戦術時。
5. **パス (Pass)**: 上記以外の場合、最も安全な味方へパス。

### Step 3: 行動結果の判定 (Resolution)

各アクションは、攻撃側と守備側の能力値対決によって成否が決まります。

#### シュート成功判定
- **攻撃力**: `(Power * 0.7 + Technique * 0.3)` × 距離減衰
- **守備力**: `(Defense * 0.6 + Power * 0.4)` × ブロック率 × コンパクトネス
- **結果**: 攻撃力が守備力を上回り、かつランダム判定に成功すれば**ゴール**。失敗時はブロックまたは枠外。

#### ドリブル突破判定
- **攻撃力**: `Technique * 0.6 + Speed * 0.4`
- **守備力**: `Defense * 0.7 + Speed * 0.3` × プレス強度
- **結果**: 守備側が上回ると**タックル成功（ボールロスト）**。攻撃側が勝てば前進。

#### パス・スルーパス判定
- **攻撃力**: `Technique` + 戦術ボーナス
- **守備力**: `Defense` × カバー範囲 × インターセプト率
- **結果**: 守備側が上回ると**インターセプト（ボールロスト）**。成功すればボールが繋がり、局面が前進。

#### クロス・ヘディング判定
- **クロス精度**: `Technique`依存。
- **空中戦**: FWの`Power` vs DFの`Power + Defense`。
- **結果**: クロスが通り、かつ空中戦に勝てば**ゴール**。

---

## 4. 勝敗決定 (Conclusion)

200ステップ終了時点でのスコア（Home Goals vs Away Goals）で勝敗が決まります。
また、以下のスタッツも記録されます：
- 支配率 (Possession)
- シュート数 (Shots)
- 成功したアクション数（パス、ドリブル等）

このロジックにより、**「足の速いFWを配置してカウンターを狙う」** や **「テクニックのあるMFでポゼッションを高める」** といった戦術的な相性が試合結果に反映されるようになっています。
